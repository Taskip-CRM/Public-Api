# Quotation Management API

The Quotation Management API allows you to manage quotations/estimates in your TaskIP CRM system. You can create, read, update, and delete quotations, convert them to invoices, and manage their approval workflow.

## Endpoints Overview

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/public-v1/quotation` | Get all quotations |
| `POST` | `/api/public-v1/quotation` | Create a new quotation |
| `GET` | `/api/public-v1/quotation/{id}` | Get a specific quotation |
| `PUT` | `/api/public-v1/quotation/{id}` | Update a quotation |
| `DELETE` | `/api/public-v1/quotation/{id}` | Delete a quotation |
| `POST` | `/api/public-v1/quotation/{id}/convert-to-invoice` | Convert quotation to invoice |
| `POST` | `/api/public-v1/quotation/{id}/send-to-client` | Send quotation to client via email |
| `POST` | `/api/public-v1/quotation/{id}/status-update` | Update quotation status |
| `POST` | `/api/public-v1/quotation/bulk-actions` | Perform bulk operations |

---

## Get All Quotations

Retrieve a list of all quotations in your system.

```http
GET /api/public-v1/quotation
```

### Request Headers
```http
X-Secret-Key: your-secret-key-here
Content-Type: application/json
```

### Query Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `page` | integer | No | Page number for pagination (default: 1) |
| `limit` | integer | No | Number of quotations per page (default: 50) |
| `search` | string | No | Search term for quotation number or client name |
| `sort` | string | No | Sort field (`quotation_number`, `total_amount`, `created_at`) |
| `order` | string | No | Sort order (`asc` or `desc`) |
| `status` | string | No | Filter by status (`draft`, `sent`, `accepted`, `rejected`, `expired`) |
| `client_id` | integer | No | Filter by client ID |
| `date_from` | string | No | Filter quotations from date (YYYY-MM-DD) |
| `date_to` | string | No | Filter quotations to date (YYYY-MM-DD) |

### Example Request

```bash
curl -X GET "https://public-api.taskip.net/api/public-v1/quotation?page=1&limit=20&status=sent" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json"
```

### JavaScript Example
```javascript
const response = await fetch('https://public-api.taskip.net/api/public-v1/quotation?page=1&limit=20', {
  method: 'GET',
  headers: {
    'X-Secret-Key': 'your-secret-key-here',
    'Content-Type': 'application/json'
  }
});

const quotations = await response.json();
```

### Example Response

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "quotation_number": "QUO-2024-001",
      "client_id": 15,
      "client_name": "Acme Corporation",
      "client_email": "billing@acme.com",
      "issue_date": "2024-01-15",
      "valid_until": "2024-02-14",
      "status": "sent",
      "currency": "USD",
      "subtotal": 4500.00,
      "tax_rate": 10.00,
      "tax_amount": 450.00,
      "discount_amount": 0.00,
      "total_amount": 4950.00,
      "notes": "30-day validity period",
      "terms_conditions": "Standard terms and conditions apply",
      "items": [
        {
          "id": 1,
          "description": "Web Development Services",
          "quantity": 1,
          "unit_price": 4500.00,
          "line_total": 4500.00
        }
      ],
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T10:30:00Z"
    }
  ],
  "meta": {
    "current_page": 1,
    "per_page": 20,
    "total": 25,
    "total_pages": 2
  }
}
```

---

## Create a Quotation

Create a new quotation in your system.

```http
POST /api/public-v1/quotation
```

### Request Headers
```http
X-Secret-Key: your-secret-key-here
Content-Type: application/json
```

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `client_id` | integer | Yes | Client ID for the quotation |
| `issue_date` | string | Yes | Issue date (YYYY-MM-DD) |
| `valid_until` | string | Yes | Validity date (YYYY-MM-DD) |
| `currency` | string | No | Currency code (default: USD) |
| `tax_rate` | decimal | No | Tax rate percentage |
| `discount_amount` | decimal | No | Discount amount |
| `notes` | string | No | Internal notes |
| `terms_conditions` | string | No | Terms and conditions |
| `status` | string | No | Status (`draft`, `sent`) |
| `items` | array | Yes | Array of quotation items |

#### Item Object Structure
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `description` | string | Yes | Item description |
| `quantity` | decimal | Yes | Item quantity |
| `unit_price` | decimal | Yes | Price per unit |

### Example Request

```bash
curl -X POST "https://public-api.taskip.net/api/public-v1/quotation" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": 15,
    "issue_date": "2024-01-20",
    "valid_until": "2024-02-19",
    "currency": "USD",
    "tax_rate": 8.5,
    "discount_amount": 200.00,
    "notes": "Custom website development quote",
    "terms_conditions": "50% upfront payment required",
    "status": "draft",
    "items": [
      {
        "description": "Custom Website Development",
        "quantity": 1,
        "unit_price": 5000.00
      },
      {
        "description": "SEO Optimization",
        "quantity": 1,
        "unit_price": 800.00
      }
    ]
  }'
```

### Python Example
```python
import requests

headers = {
    'X-Secret-Key': 'your-secret-key-here',
    'Content-Type': 'application/json'
}

quotation_data = {
    "client_id": 15,
    "issue_date": "2024-01-20",
    "valid_until": "2024-02-19",
    "currency": "USD",
    "tax_rate": 8.5,
    "discount_amount": 200.00,
    "notes": "Custom website development quote",
    "terms_conditions": "50% upfront payment required",
    "status": "draft",
    "items": [
        {
            "description": "Custom Website Development",
            "quantity": 1,
            "unit_price": 5000.00
        },
        {
            "description": "SEO Optimization",
            "quantity": 1,
            "unit_price": 800.00
        }
    ]
}

response = requests.post(
    'https://public-api.taskip.net/api/public-v1/quotation',
    headers=headers,
    json=quotation_data
)

result = response.json()
```

### Example Response

```json
{
  "success": true,
  "message": "Quotation created successfully",
  "data": {
    "id": 26,
    "quotation_number": "QUO-2024-026",
    "client_id": 15,
    "client_name": "Acme Corporation",
    "client_email": "billing@acme.com",
    "issue_date": "2024-01-20",
    "valid_until": "2024-02-19",
    "status": "draft",
    "currency": "USD",
    "subtotal": 5800.00,
    "tax_rate": 8.50,
    "tax_amount": 493.00,
    "discount_amount": 200.00,
    "total_amount": 6093.00,
    "notes": "Custom website development quote",
    "terms_conditions": "50% upfront payment required",
    "items": [
      {
        "id": 45,
        "description": "Custom Website Development",
        "quantity": 1,
        "unit_price": 5000.00,
        "line_total": 5000.00
      },
      {
        "id": 46,
        "description": "SEO Optimization",
        "quantity": 1,
        "unit_price": 800.00,
        "line_total": 800.00
      }
    ],
    "created_at": "2024-01-20T14:30:00Z",
    "updated_at": "2024-01-20T14:30:00Z"
  }
}
```

---

## Get a Specific Quotation

Retrieve details of a specific quotation by ID.

```http
GET /api/public-v1/quotation/{id}
```

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | Quotation ID |

### Example Request

```bash
curl -X GET "https://public-api.taskip.net/api/public-v1/quotation/26" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json"
```

### Example Response

```json
{
  "success": true,
  "data": {
    "id": 26,
    "quotation_number": "QUO-2024-026",
    "client_id": 15,
    "client": {
      "id": 15,
      "name": "Acme Corporation",
      "email": "billing@acme.com",
      "phone": "+1-555-0100",
      "company": "Acme Corporation"
    },
    "issue_date": "2024-01-20",
    "valid_until": "2024-02-19",
    "status": "draft",
    "currency": "USD",
    "subtotal": 5800.00,
    "tax_rate": 8.50,
    "tax_amount": 493.00,
    "discount_amount": 200.00,
    "total_amount": 6093.00,
    "notes": "Custom website development quote",
    "terms_conditions": "50% upfront payment required",
    "items": [
      {
        "id": 45,
        "description": "Custom Website Development",
        "quantity": 1,
        "unit_price": 5000.00,
        "line_total": 5000.00
      },
      {
        "id": 46,
        "description": "SEO Optimization",
        "quantity": 1,
        "unit_price": 800.00,
        "line_total": 800.00
      }
    ],
    "history": [
      {
        "action": "created",
        "user": "John Smith",
        "timestamp": "2024-01-20T14:30:00Z"
      }
    ],
    "created_at": "2024-01-20T14:30:00Z",
    "updated_at": "2024-01-20T14:30:00Z"
  }
}
```

---

## Update a Quotation

Update an existing quotation's information.

```http
PUT /api/public-v1/quotation/{id}
```

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | Quotation ID to update |

### Request Body
Same fields as create quotation. All fields are optional - only include fields you want to update.

### Example Request

```bash
curl -X PUT "https://public-api.taskip.net/api/public-v1/quotation/26" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "valid_until": "2024-03-20",
    "tax_rate": 10.0,
    "notes": "Extended validity period - custom website with advanced features"
  }'
```

### Example Response

```json
{
  "success": true,
  "message": "Quotation updated successfully",
  "data": {
    "id": 26,
    "quotation_number": "QUO-2024-026",
    "client_id": 15,
    "client_name": "Acme Corporation",
    "client_email": "billing@acme.com",
    "issue_date": "2024-01-20",
    "valid_until": "2024-03-20",
    "status": "draft",
    "currency": "USD",
    "subtotal": 5800.00,
    "tax_rate": 10.00,
    "tax_amount": 580.00,
    "discount_amount": 200.00,
    "total_amount": 6180.00,
    "notes": "Extended validity period - custom website with advanced features",
    "terms_conditions": "50% upfront payment required",
    "created_at": "2024-01-20T14:30:00Z",
    "updated_at": "2024-01-21T09:15:00Z"
  }
}
```

---

## Delete a Quotation

Delete a specific quotation from your system.

```http
DELETE /api/public-v1/quotation/{id}
```

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | Quotation ID to delete |

import { Callout } from 'nextra-theme-docs'

<Callout type="warning" emoji="⚠️">
  **Warning**: Deleting a quotation will permanently remove it and all associated data. This action cannot be undone.
</Callout>

### Example Request

```bash
curl -X DELETE "https://public-api.taskip.net/api/public-v1/quotation/26" \
  -H "X-Secret-Key: your-secret-key-here"
```

### Example Response

```json
{
  "success": true,
  "message": "Quotation deleted successfully",
  "data": {
    "deleted_quotation_id": 26,
    "quotation_number": "QUO-2024-026"
  }
}
```

---

## Convert Quotation to Invoice

Convert an accepted quotation into an invoice.

```http
POST /api/public-v1/quotation/{id}/convert-to-invoice
```

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | Quotation ID to convert |

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `due_date` | string | Yes | Invoice due date (YYYY-MM-DD) |
| `payment_terms` | string | No | Payment terms for the invoice |

### Example Request

```bash
curl -X POST "https://public-api.taskip.net/api/public-v1/quotation/25/convert-to-invoice" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "due_date": "2024-02-20",
    "payment_terms": "Net 30"
  }'
```

### JavaScript Example
```javascript
const conversionData = {
  due_date: "2024-02-20",
  payment_terms: "Net 30"
};

const response = await fetch('https://public-api.taskip.net/api/public-v1/quotation/25/convert-to-invoice', {
  method: 'POST',
  headers: {
    'X-Secret-Key': 'your-secret-key-here',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(conversionData)
});

const result = await response.json();
```

### Example Response

```json
{
  "success": true,
  "message": "Quotation converted to invoice successfully",
  "data": {
    "quotation_id": 25,
    "quotation_number": "QUO-2024-025",
    "invoice_id": 150,
    "invoice_number": "INV-2024-150",
    "conversion_date": "2024-01-22T11:30:00Z"
  }
}
```

---

## Send Quotation to Client

Send quotation to client via email.

```http
POST /api/public-v1/quotation/{id}/send-to-client
```

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | Quotation ID to send |

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `email_template` | string | No | Email template to use |
| `custom_message` | string | No | Custom message to include |
| `cc_emails` | array | No | Additional CC email addresses |
| `send_copy_to_self` | boolean | No | Send copy to sender (default: true) |

### Example Request

```bash
curl -X POST "https://public-api.taskip.net/api/public-v1/quotation/25/send-to-client" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "custom_message": "Please review the attached quotation for your project requirements.",
    "cc_emails": ["manager@company.com"],
    "send_copy_to_self": true
  }'
```

### Example Response

```json
{
  "success": true,
  "message": "Quotation sent to client successfully",
  "data": {
    "quotation_id": 25,
    "sent_to": "billing@acme.com",
    "cc_emails": ["manager@company.com"],
    "sent_at": "2024-01-22T14:45:00Z",
    "email_tracking_id": "email_track_789"
  }
}
```

---

## Update Quotation Status

Update the status of a quotation.

```http
POST /api/public-v1/quotation/{id}/status-update
```

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | Quotation ID |

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `status` | string | Yes | New status (`draft`, `sent`, `accepted`, `rejected`, `expired`) |
| `reason` | string | No | Reason for status change |
| `notes` | string | No | Additional notes |

### Example Request

```bash
curl -X POST "https://public-api.taskip.net/api/public-v1/quotation/25/status-update" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "accepted",
    "reason": "Client approved via phone",
    "notes": "Client requested to start work immediately"
  }'
```

### Example Response

```json
{
  "success": true,
  "message": "Quotation status updated successfully",
  "data": {
    "quotation_id": 25,
    "old_status": "sent",
    "new_status": "accepted",
    "reason": "Client approved via phone",
    "updated_at": "2024-01-22T16:20:00Z"
  }
}
```

---

## Bulk Actions

Perform bulk operations on multiple quotations.

```http
POST /api/public-v1/quotation/bulk-actions
```

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `quotation_ids` | array | Yes | Array of quotation IDs |
| `action` | string | Yes | Action to perform (`delete`, `status_update`, `send_to_clients`) |
| `parameters` | object | No | Additional parameters for the action |

#### Action-specific Parameters

**For `status_update` action:**
- `status`: New status for all quotations
- `reason`: Reason for status change

**For `send_to_clients` action:**
- `email_template`: Email template to use
- `custom_message`: Custom message for all emails

### Example Request

```bash
curl -X POST "https://public-api.taskip.net/api/public-v1/quotation/bulk-actions" \
  -H "X-Secret-Key: your-secret-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "quotation_ids": [20, 21, 22, 23],
    "action": "status_update",
    "parameters": {
      "status": "expired",
      "reason": "Validity period ended"
    }
  }'
```

### JavaScript Example
```javascript
const bulkData = {
  quotation_ids: [20, 21, 22, 23],
  action: "send_to_clients",
  parameters: {
    email_template: "quotation_reminder",
    custom_message: "This is a reminder about your pending quotation."
  }
};

const response = await fetch('https://public-api.taskip.net/api/public-v1/quotation/bulk-actions', {
  method: 'POST',
  headers: {
    'X-Secret-Key': 'your-secret-key-here',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(bulkData)
});

const result = await response.json();
```

### Example Response

```json
{
  "success": true,
  "message": "Bulk action completed successfully",
  "data": {
    "action": "status_update",
    "processed_count": 4,
    "successful_ids": [20, 21, 22, 23],
    "failed_ids": [],
    "results": [
      {
        "quotation_id": 20,
        "status": "success",
        "message": "Status updated to expired"
      },
      {
        "quotation_id": 21,
        "status": "success",
        "message": "Status updated to expired"
      },
      {
        "quotation_id": 22,
        "status": "success",
        "message": "Status updated to expired"
      },
      {
        "quotation_id": 23,
        "status": "success",
        "message": "Status updated to expired"
      }
    ]
  }
}
```

---

## Error Responses

### Common Error Codes

| Status Code | Error Type | Description |
|-------------|------------|-------------|
| `400` | Bad Request | Invalid request data or missing required fields |
| `401` | Unauthorized | Invalid or missing X-Secret-Key |
| `404` | Not Found | Quotation not found |
| `409` | Conflict | Quotation cannot be modified in current status |
| `422` | Validation Error | Request data failed validation |
| `429` | Too Many Requests | Rate limit exceeded |

### Example Error Response

```json
{
  "success": false,
  "error": "Validation Error",
  "message": "The given data was invalid",
  "errors": {
    "client_id": ["The client id field is required."],
    "items": ["At least one item is required."],
    "valid_until": ["The valid until date must be after issue date."]
  },
  "status_code": 422
}
```

---

## Response Schemas

### Quotation Object

```json
{
  "id": "integer",
  "quotation_number": "string",
  "client_id": "integer",
  "client_name": "string",
  "client_email": "string",
  "issue_date": "string (YYYY-MM-DD)",
  "valid_until": "string (YYYY-MM-DD)",
  "status": "string",
  "currency": "string",
  "subtotal": "decimal",
  "tax_rate": "decimal",
  "tax_amount": "decimal",
  "discount_amount": "decimal",
  "total_amount": "decimal",
  "notes": "string|null",
  "terms_conditions": "string|null",
  "items": "array",
  "created_at": "string (ISO 8601)",
  "updated_at": "string (ISO 8601)"
}
```

### Quotation Item Object

```json
{
  "id": "integer",
  "description": "string",
  "quantity": "decimal",
  "unit_price": "decimal",
  "line_total": "decimal"
}
```

### Client Summary Object (in quotation details)

```json
{
  "id": "integer",
  "name": "string",
  "email": "string",
  "phone": "string|null",
  "company": "string|null"
}
```

---

## Best Practices

### Quotation Creation
1. **Clear descriptions**: Use detailed item descriptions for better client understanding
2. **Realistic validity periods**: Set appropriate validity periods based on project complexity
3. **Professional presentation**: Include comprehensive terms and conditions
4. **Accurate pricing**: Double-check calculations before sending to clients

### Workflow Management
1. **Status tracking**: Use proper status progression (draft → sent → accepted/rejected)
2. **Client communication**: Send quotations with personalized messages
3. **Follow-up**: Track quotation status and follow up on pending quotations
4. **Conversion timing**: Convert accepted quotations to invoices promptly

### Data Management
1. **Regular cleanup**: Archive or delete expired quotations
2. **Template usage**: Create standardized quotation templates
3. **Backup important quotes**: Keep copies of significant quotations
4. **Version control**: Track changes when updating quotations

<Callout type="info" emoji="💡">
  **Tip**: Use the bulk actions endpoint to efficiently manage multiple quotations. This is particularly useful for updating statuses of expired quotations or sending reminder emails to multiple clients.
</Callout>